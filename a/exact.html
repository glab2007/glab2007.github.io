<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru">

<head>
<title>Точность пространственных данных в MapInfo и методы её повышения &frasl;GLab&copy;2007&frasl;</title>

<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta http-equiv="content-type" content="text/css; charset=utf-8" />
<meta name="Author" content="GLab&copy;2007 http://www.glab2007.narod.ru" />
<meta name="Description" content="Принципы хранения пространственных данных в MapInfo и практические рекомендации для достижения более высокой точности объектов карты на сайте проекта GLab&copy;2007." />
<meta name="KeyWords" content="пространственные данные mapinfo, точность координат, изменение датума" />

<link rel="shortcut icon" href="../i/favicon.ico" type="image/x-icon" />
<link rel="icon" href="../i/favicon.ico" type="image/x-icon" />
<link type="text/css" rel="stylesheet" href="../style.css" />

<script src="https://yastatic.net/es5-shims/0.0.2/es5-shims.min.js" charset="utf-8"></script>
<script src="https://yastatic.net/share2/share.js" async="async" charset="utf-8"></script>
<script type="text/javascript" src="../scripts.js"></script>

</head>
<body>

<div id="left">
	<ul>
		<li class="home"><a href="../main.html" title="На главную">На <br />главную</a></li>
		<li class="news"><a href="../index.html" title="Новости" style="line-height: 36px; ">Новости</a></li>
		<li class="query"><a href="../query.html" title="Топ запросов">Топ<br />запросов</a></li>
		<li class="article"><a id="item" href="../article.html" title="Статьи" style="line-height: 36px; ">Статьи</a></li>
		<li class="download"><a href="../download.html" title="Загрузка" style="line-height: 36px; ">Загрузка</a></li>
		<li class="links"><a href="../links.html" title="Ссылки">Каталог<br />ссылок</a></li>
		<li class="about"><a href="../about.html" title="О проекте">О<br />проекте</a></li>
		<li class="contact"><a href="../contact.html" title="Контактная информация" style="line-height: 36px; ">Контакты</a></li>
		<li class="search"><a href="../main.html#search" title="Поиск">Поиск<br />по сайту</a></li>
		<li class="map"><a href="../map.html" title="Карта сайта">Карта<br />сайта</a></li>
	</ul>
</div>
<div id="arrow">
	<a href="#">
		<img src="../i/arr.gif" alt="Вверх" />
	</a>
</div>
<div class="ya-share2" data-services="vkontakte,facebook,linkedin,viber"></div>

<div id="top"></div>

<div id="border_left"><div id="border_right"><div id="border_top"><div id="border_bottom">
	<div id="content">

		<h1 class="article">
			Точность пространственных данных в MapInfo и методы её повышения
		</h1>

		<div class="avatar">
			<a href="http://mapinfo.ru" title="&quot;Эсти Мэп&quot; &ndash; геоинформационные системы"><img class="inline" src="exact/0.png" alt="Эсти Мэп" width="101px; " height="28px; " /></a>
		</div>
		<p class="small">
			Автор: <a href="http://www.pitneybowes.com">MapInfo Corporation</a> &copy;&nbsp;2006<br />
			Перевод: <a href="http://mapinfo.ru">ЭСТИ МАП</a> &copy;&nbsp;2014
		</p>
		<p class="small">
			Оригинал этой статьи за авторством Шон Ричардса (Sean Richards) был опубликован ещё в 2006 году, но, по вполне понятным причинам, оказался не вполне замечен русскоязычным сообществом пользователей MapInfo. К сожалению. Потому как в статье давались ответы на многие вопросы, связанные с точностью хранения и отображения координат, бурно обсуждаемые много лет на форумах и прочих площадках.
		</p>
		<p class="small">
			В 2014 году компания ЭСТИ МАП выложила на своём новом сайте адаптированный перевод оригинальной статьи. Опять же, не замеченный пользователем, судя по продолжающим возникать на форумах вопросам. В то время как и сама статья, и её блистательный перевод, несомненно, заслуживают крайне внимательного прочтения и изучения.
		</p>
		<p class="small">
			Итак, цитата:
			<span class="small passage">&laquo;В этой статье мы проведем исследование и анализ того, каким образом следует настроить ваши продукты MapInfo, чтобы достичь максимальной пространственной точности, отвечающей бизнес-потребностям вашей организации.&raquo;</span>
		</p>
		<hr class="split" />

		<ul id="toc">
			<li><a href="#ch1">Достижение высокой точности</a></li>
			<li><a href="#ch2">Исходные данные</a></li>
			<li><a href="#ch3">Последовательность процесса</a></li>
			<li><a href="#ch4">32-разрядные против 64-разрядных целых чисел</a></li>
			<li><a href="#ch5">Отображение данных в режиме высокой точности</a></li>
			<li><a href="#ch6">Экспорт с высокой точностью</a></li>
			<li><a href="#ch7">Импорт с высокой точностью</a></li>
			<li><a href="#ch8">Резюме</a></li>
		</ul>
		<hr class="split" />

<!--1-->
		<h2 id="ch1">Достижение более высокой точности при хранении координат объектов карты</h2>
		<p>
			&laquo;Каким образом можно получить более высокий уровень точности в MapInfo Professional?&raquo;. Обычно за этим вопросом следует: &laquo;Почему бы не использовать 64-разрядную точность данных, как в некоторых других системах?&raquo;. Для того чтобы получить ответы на эти вопросы, сначала необходимо понять как MapInfo осуществляет хранение пространственных данных.
		</p>
		<p>
			Вы можете предположить, что в файл просто записываются такие числа, как 153.34125 и -26.21435. Этот метод сработает, но он будет очень неэффективным и медленным. Что делает MapInfo Professional &ndash; она хранит все данные, записанные в файл в едином формате точности, выраженном в 32-разрядных целых числах. 32-разрядное целое число может содержать целые значения от 0 до более 2 миллиардов. Когда таблица считывается, MapInfo Professional преобразует эти данные, выраженные в целых числах, обратно в их реальные координаты и хранит их в памяти как 64-разрядные числа с плавающей запятой. Может это выглядит, как очень трудоемкий процесс, но на самом деле именно таким образом функционируют системы, которым приходится оперировать большими числами.
		</p>
		<img src="exact/1.png" alt="Широта/Долгота"style="float:left; height:214px; width:146px; " />
		<p>
			Точность зависит от того, в какой системе координат данные будут храниться. Например, если используются координаты Долгота/Широта, числа необходимо хранить в диапазонах от -180 до +180 и от -90 до +90. Это означает, что самое большое число, которое нам требуется &ndash; это 360. Однако по математическим соображениям используется диапазон от -1000 до +1000, что делает 2000 самым большим числом. Если далее разделить этот диапазон на возможные 2 миллиарда из 32-разрядного целого, то получим 0.000001 градуса (около 100 миллиметров).
		</p>
		<p>
			В данной ситуации следует запомнить, что эта система координат используемая по умолчанию. Ниже будет описан метод, имеющийся в арсенале MapInfo Professional, который позволяет повысить уровень точности. Очень небольшому количеству приложений ГИС когда-либо требовалось получать координаты земного шара с субмиллиметровой точностью. Обычно пользователи ГИС работают с гораздо меньшими территориями, такими как области, районы и даже отдельные города. Мы называем это &laquo;ограниченными координатами&raquo; (bounded coordinates).
		</p>
		<p>
			Все слои пространственных данных MapInfo являются ограниченными. Как было показано выше, стандартная проекция Мира ограничена диапазоном +/-1000. Это называется &laquo;неявным ограничением&raquo;, поскольку нет никакого указания на диапазон координат. Все проекции имеют неявные ограничения.
		</p>
		<p>
			<a href="exact/2_1.png" title="Просмотреть"><img src="exact/2.png" alt="Картографическая сетка Австралии"style="float:right; height:230px; width:283px; " /></a>
			Рассмотрим картографическую сетку Австралии: MGA (UTM проекция, которая обычно используется в Австралии). Это полосы шириной 6 градусов, которые обертывают весь глобус. При выборе проекции из диалога, вы выбираете конкретную зону (шириной 6 градусов) для северного либо южного полушария. Границами в данном случае будут 10,000,000 м на север (Экватор) и 0 м на 80 градусов южной широты. Проекция также имеет ширину 1,000,000 метров с центром на 500,000 м.
		</p>
		<p>
			Используя тот же метод, что был описан выше, данная проекция имеет числовой диапазон 10,000,000. Разделив на 2 миллиарда, получаем точность 0.005 метра (полсантиметра).
		</p>
		<div class="split">
			<a href="#toc">К оглавлению &gt;&gt;&gt;</a>
			<hr />
		</div>

<!--2-->
		<h2 id="ch2">Исходные данные</h2>
		<p>
			Для получения более высокой точности MapInfo Professional также поддерживает &laquo;явное ограничение&raquo;, при котором пользователь может вручную задать границы координат. Примером может служить создание План-схемы, когда требуется задать минимальные и максимальные значения координат. &laquo;Явное ограничение&raquo; также может использоваться для любых стандартных проекций. Когда вы делаете это, вы задаете меньший диапазон для своих координат. Чем меньше диапазон, тем выше точность. Например:
		</p>
		<img src="exact/3.png" alt="Глобус"style="float:left; height:129px; margin-right:20px; width:129px; " />
		<ul>
			<li>
				Брисбен, Австралия ограничен UTM координатами 7,000,000 (Север), 6,930,000 (Юг), 470,000 (Запад) и 530,000 (Восток). Максимальный диапазон здесь составляет 70,000 м. разделите это на 2 миллиарда и получите точность 0.000035 метра. Это точность 0.035 миллиметра. Применив ограничение тем же способом для всей территории Австралии, мы получим точность примерно в 2.5 миллиметра.
			</li>
			<li>
				Япония ограничена координатами 24&deg; (Север), 46&deg; (Юг), 122&deg; (Запад), 146&deg; (Восток). В этом случае приблизительная точность, доступная пользователям, при условии, что в качестве датума используется JGD2000, составит 1 миллиметр.
			</li>
		</ul>
		<p>
			Вы всегда можете использовать явное ограничение, если необходимо сохранить пространственные данные в формате более высокой точности. Тем не менее, вы не можете добавить границы к существующему слою и ожидать при этом, что данные станут более точными. После того, как вы добавите границы, на месте останутся те же самые координаты. Только после добавления новых данных или редактировании существующих вы сможете получить и использовать более высокий уровень точности.
		</p>
		<div class="split">
			<a href="#toc">К оглавлению &gt;&gt;&gt;</a>
			<hr />
		</div>

<!--3-->
		<h2 id="ch3">Последовательность процесса</h2>
		<p>
			Итак, как же создается таблица с явным ограничением? В первую очередь необходимо определить диапазон координат, который отвечает вашим требованиям. Запомните, как только границы установлены для слоя, в этом слое невозможно будет сохранять пространственные данные за пределами этих границ. Например, если вы выполняете работы для местной администрации, вы можете установить границы слоя, на 10 км выходящие за пределы реальных административных границ.
		</p>
		<p>
			Даже если вы раздвинете границы слоя на 100 км, то все равно получите гораздо более высокий уровень точности координат, чем который, возможно требовался. Если работы выполняются в государственном масштабе, то можно использовать проекцию Широта/Долгота с границами, лишь едва выходящими за пределы реальных.
		</p>
		<p>
			Далее вы создаете таблицы как обычно, устанавливая желаемую проекцию. Для применения границ в таблице запустите приложение MapBasic из меню Инструменты &rarr; Каталог программ &rarr; CoordSys Bounds Manager (Границы рамки карты). Это приложение покажет список уже открытых слоев. Границы выбранного слоя отображаются, как показано на рисунке ниже.
		</p>
		<img src="exact/4.png" alt="Глобус"style="height:410px; width:726px; " />
		<p>
			Вы можете вручную ввести границы или использовать кнопку Optimise CoordSys Bound (Оптимизировать рамку), чтобы автоматически считать требуемые границы из слоя. Затем, вы сохраняете новую копию таблицы. Хороший подход &ndash; создать новую пустую таблицу с явно установленным границами. Впоследствии при создании новых таблиц используйте копию этого пустого файла (используйте команду &laquo;Новая таблица&raquo;).
		</p>
		<p>
			Иногда вы можете получать данные из других систем в формате MIF/MID. В зависимости от источника эти данные могут оказаться более высокой точности, чем та которую может обрабатывать стандартная проекция с неявным ограничением. Например, файл в формате MIF/MID, экспортированный из другой системы в проекцию GDA, может иметь три десятичных разряда. Если вы просто импортируете его в MapInfo Professional, то в итоге получите данные для двух десятичных разрядов. Чтобы сохранить полную точность, предлагается открыть MIF файл в любом текстовом редакторе и добавить соответствующие настройки проекции, включая границы (Bounds), в раздел заголовка. В этом случае при импорте данных, вы получите точность 3-х десятичных разрядов, как и в оригинальных данных.
		</p>
		<div class="split">
			<a href="#toc">К оглавлению &gt;&gt;&gt;</a>
			<hr />
		</div>

<!--4-->
		<h2 id="ch4">32-разрядные против 64-разрядных целых чисел</h2>
		<p>
			Pitney Bowes Software предпочла использовать 32-разрядные целые числа для внешнего хранения вместо 64-разрядных, поскольку это позволяет добиться хорошего соотношения между эффективностью и точностью. Использование 32-разрядных целых чисел для хранения также означает, что пространственные данные MapInfo при хранении занимают в два раза меньше места, чем такой же эквивалент 64-разрядных данных. Это не только более эффективно, но и позволяет загружать данные и выводить их на монитор значительно быстрее.
		</p>
		<div class="split">
			<a href="#toc">К оглавлению &gt;&gt;&gt;</a>
			<hr />
		</div>

<!--5-->
		<h2 id="ch5">Отображение данных в режиме высокой точности</h2>
		<p>
			Как было продемонстрировано выше, MapInfo Professional имеет возможность хранить данные с более высоким уровнем точности, если требуется. Следующим шагом является просмотр координат. На карте (справа) нанесены два набора точек. Жёлтые точки были помещены в таблицу с установленными границами, в то время как оранжевые точки поместили в неограниченную таблицу. Используя инструмент &laquo;Выбор&raquo;, вы можете двойным щелчком мыши на точках увидеть их координаты. Ниже карты вы видите два снимка экрана, где показаны координаты точки на карте. На первом показаны координаты точки в таблице с установленными границами. На втором экране показаны координаты точки в неограниченной таблице. Обратите внимание на то, что неограниченная таблица показывает только 6 десятичных разрядов, в то время как таблица с установленными границами показывает 7 или 8 десятичных разрядов.
		</p>
		<p>
			Далее вы, возможно, захотите посмотреть координаты в окне Списка. На этом этапе многие пользователи сталкиваются с трудностями. Это происходит поэтому, что MapInfo Professional всегда отображает поля типа FLOAT округленными до установленного количества десятичных разрядов. Это означает, что пользователь не увидит все десятичные разряды. Для того, чтобы обойти эту проблему, следует использовать тип DECIMAL для полей с координатами. В диалоге &laquo;Перестройка структуры таблицы&raquo; (Modify Table Structure) вы видите, как поля Широта/Долгота настроены на хранение 12 цифр с 8-ю после десятичной точки.
		</p>
		<img src="exact/5_1.png" alt="координаты точки" style="float:right; height:245px; width:520px; " />
		<div>
			<img src="exact/5_2.png" alt="Координаты точки" style="height:103px; width:338px; " /><span class="small">Таблица с неуказанными границами</span>
		</div>
		<hr />
		<div>
			<img src="exact/5_3.png" alt="Координаты точки" style="height:103px; width:338px; " /><span class="small">Таблица с заданной границей</span>
		</div>
		<img src="exact/6.png" alt="Структура таблицы" style="float:right; height:428px; width:419px; " />
		<p>
			После того, как структура таблицы была корректно установлена, необходимо будет обновить эти поля значениями координат объектов. Рекомендуется использовать утилиту &laquo;Записать координаты объекта&raquo;, которая поставляется вместе с MapInfo Professional. Этот инструмент находится в Каталоге программ (меню &laquo;Инструменты&raquo; программы MapInfo Professional). Утилита позволяет автоматически обновить две колонки таблицы, наполнив их координатами центроида объектов. Во время использования данного инструмента вы имеете возможность определить, какая система координат будет использоваться. Это очень важный, момент поскольку используемая для извлечения система координат является ограниченной.
		</p>
		<p>
			Ниже показано окно Списка для таблицы с ограничением, после того, как утилита &laquo;Записать координаты объектаrlaquo; была запущена. Обратите внимание, что координаты используют восемь десятичных разрядов так же, как в предыдущем примере с использованием инструмента &laquo;Выбор&raquo;.
		</p>
		<p>
			Альтернативным методом является использование команды &laquo;Обновить колонку&raquo; (Update table Set column). Вы можете заполнить поля координатами, используя функции CentroidX(obj) и CentroidY(obj) объекта.
		</p>
		<img src="exact/7_1.png" alt="Обновить колонку" style="height:175px; width:492px; " />
		<img src="exact/7_2.png" alt="Обновить колонку" style="height:175px; width:492px; " />
		<p>
			Нули в конце значений указывают, что не все доступные десятичные разряды были использованы.
		</p>
		<img src="exact/8.png" alt="Окно MapBasic" style="height:95px; width:492px; " />
		<p>
			Этот подход использует проекцию сессии MapInfo Professional, а не проекцию таблицы. Для извлечения полных координатных данных необходимо настроить проекцию сессии на проекцию таблицы, в которой находятся объекты. Это можно сделать из диалога Настройки > Режимы > Окно Карты &ndash; закладка Проекция или напечатав строку определения координатной системы в окне MapBasic (как показано сверху). Окно Списка (второе) показывает результаты применения метода &laquo;Обновить колонку&raquo; без установки проекции в координатной системе с определенными границами.
		</p>
		<p>
			Последним методом отображения координат является SQL запрос и отображение координат во временных полях, созданных в операторе SQL. Еще раз напоминаем, что сначала необходимо настроить систему координат сессии на ограниченную проекцию.
		</p>
		<p>
			Ниже показан диалог SQL Select используемый для получения координат.
		</p>
		<img src="exact/9.png" alt="SQL-запрос" style="height:515px; width:465px; " />
		<div class="split">
			<a href="#toc">К оглавлению &gt;&gt;&gt;</a>
			<hr />
		</div>

<!--6-->
		<h2 id="ch6">Экспорт с высокой точностью</h2>
		<p>
			MapInfo Professional поддерживает несколько форматов экспорта данных, позволяющих использовать их в других системах. Два наиболее распространенных формата &ndash; это MIF/MID и Autocad DXF. Команда Таблица &rarr; Экспорт поддерживает точность координат во время их экспорта в MIF/MID. Это показано ниже вместе с двумя примерами MIF экспорта. В первом приводится Ограниченная таблица с координатными значениями высокой точности. Во втором примере представлена Неограниченная таблица, содержащая только 6 десятичных разрядов точности.
		</p>
		<img src="exact/10.png" alt="С границами" style="height:394px; width:727px; " />
		<img src="exact/11.png" alt="Без границ" style="height:394px; width:727px; " />
		<p>
			При экспорте в DXF из ограниченной таблицы с использованием команды Таблица &rarr; Экспорт (даже если координатная система сессии была установлена), будет производиться округление данных до 6 десятичных разрядов. Вместо этого можно использовать инструмент Универсальный транслятор (Universal Translator в MapInfo Professional v11.5 и ниже, FME Quick Translator в MapInfo Professional v12.0). Поскольку данный инструмент фактически работает за пределами MapInfo Professional, он получает данные координатной системы непосредственно из таблицы, а не из координатной системы сессии MapInfo. Здесь представлены диалоги Универсального транслятора. Ниже &ndash; пример вывода результатов в Блокнот. Обратите внимание на то, что извлеченные координаты имеют более высокую точность.
		</p>
		<div>
			<img class="inline" src="exact/12.png" alt="Универсальный Транслятор 1" style="height:363px; width:389px; " />
			<img class="inline" src="exact/13.png" alt="Универсальный Транслятор 2" style="height:399px; width:369px; " />
		</div>
		<img src="exact/14.png" alt="DXF" style="height:305px; width:726px; " />
		<div class="split">
			<a href="#toc">К оглавлению &gt;&gt;&gt;</a>
			<hr />
		</div>

<!--7-->
		<h2 id="ch7">Импорт с высокой точностью</h2>
		<p>
			Процесс импорта схож с экспортом в том, что MapInfo Professional без проблем поддерживает формат MIF/MID, но все равно придется использовать Универсальный транслятор для DXF. Важным моментом в MIF/MID является тот факт, что файл уже содержит координатную информацию в разделе заголовка.
		</p>
		<img src="exact/15.png" alt="Заголовок Mid/Mif" style="height:397px; width:726px; " />
		<p>
			Как показано в примере, координатная система таблицы определена наверху MIF/MID файла. Если ваш MIF/MID файл был создан не MapInfo Professional, а другой системой и предоставляет более 6-ти десятичных разрядов, тогда следует убедиться в том, что система координат содержит оператор границ (Bounds). При необходимости это можно сделать вручную, используя любой текстовый редактор.
		</p>
		<p>
			При импорте DXF с помощью Universal Translator пользователю будет необходимо выбрать требуемую проекцию из стандартного диалога выбора проекций. Для этого вам потребуется проекция с границами, уже введенными в файл определения MapInfo Projection (MAPINFOW.PRJ). MAPINFOW.PRJ файл можно найти в каталоге, в котором находится программа MapInfo, отредактировать его можно в любом текстовом редакторе. Ниже приведен пример ограниченной проекции (GDA94), добавленной в MAPINFOW.PRJ файл.
		</p>
		<img src="exact/16.png" alt="MAPINFOW.PRJ" style="height:184px; width:723px; " />
		<p>
			Ниже показан диалог Универсального транслятора, с настройками импорта формата DXF в MapInfo TAB. Обратите внимание на кнопку Проекция внизу справа в разделе Источник. Кнопка вызывает диалог &laquo;Выбор проекции&raquo;, в котором сейчас доступна для выбора Ограниченная проекция.
		</p>
		<div>
			<img class="inline" src="exact/17.png" alt="Универсальный Транслятор 3" style="height:399px; width:369px; " />
			<img class="inline" src="exact/18.png" alt="Универсальный Транслятор 4" style="height:352px; width:437px; " />
		</div>
		<div class="split">
			<a href="#toc">К оглавлению &gt;&gt;&gt;</a>
			<hr />
		</div>

<!--8-->
		<h2 id="ch8">Резюме</h2>
		<p>
			MapInfo Professional может работать с данными более высокой точности, если это требуется пользователю. Хранение данных с более высоким уровнем точности допустимо, только если исходные данные поставляются с сопоставимым уровнем точности.
		</p>
		<div class="split">
			<a href="#toc">К оглавлению &gt;&gt;&gt;</a>
			<hr />
		</div>

		<p class="small">
			Оригинал:<br />
			<a href="http://mapinfo.ru/node/263" title="Перейти">Точность пространственных данных</a>
		</p>
		<p class="small">
			Оригинал на английском:<br />
			<a href="http://resource.mapinfo.com/static/files/document/1153183204542/Spatial_newTemplate.pdf" title="Перейти">Focusing in on Spatial Precision</a>
		</p>
		<hr class="split" />

	</div>
</div></div></div></div>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
	(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
	m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
	(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
 
	ym(86922484, "init", {
		 clickmap:true,
		 trackLinks:true,
		 accurateTrackBounce:true
	});
 </script>
 <noscript><div><img src="https://mc.yandex.ru/watch/86922484" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
 <!-- /Yandex.Metrika counter -->

</body>
</html>